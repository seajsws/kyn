<!DOCTYPE html>
<html>
  <head>
    <title>Title - Coolest Project on the Planet!</title>
    <style type="text/css" media="screen">@import "./styles/dialog.css";</style>
    <style type="text/css" media="screen">@import "./jslib/jqtouch/jqtouch/jqtouch.css";</style>
    <style type="text/css" media="screen">@import "./jslib/jqtouch/themes/apple/theme.css";</style>
    <style type="text/css" media="screen">@import "./styles/blackspike.css";</style>
    <style type="text/css" media="screen">
    </style>

    <script src="./jslib/lib/jquery.1.5.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="./jslib/lib/jquery.tmpl.min.js" type="application/x-javascript" charset="utf-8"></script>
    <script src="./jslib/beedesk/utilities.js" type="application/x-javascript" charset="utf-8"></script>
    <script src="./jslib/beedesk/cacheca.js" type="application/x-javascript" charset="utf-8"></script>
    <script src="./jslib/jqtouch/jqtouch/jqtouch.js" type="application/x-javascript" charset="utf-8"></script>
    <script src="model.js" type="text/javascript"></script>
    <script src="main.js" type="text/javascript"></script>
    <script src="http://connect.facebook.net/en_US/all.js"></script>
    <script>
       $(document).ready(function() {
         console.warn("Document Ready");

         $("#name-dialog").bind("submit", function(event) {
           console.warn("submitting");
           var val = $(this).find("[name='username']").val();
           console.warn("val: " + val);
           if (!!val) {
             $("body").removeClass("modal");
             $(".username").text(val);
           }

           items.read(val, function(id, item) {
             console.warn("read: " + id);
           }, function(exception) {
             console.warn("exception: " + JSON.stringify(exception));
           });

           event.preventDefault();
         });

         $(".dialog input[type='button'].cancel").bind("click", function(event) {
           $(this).closest(".dialog").removeClass("show");
           $("body").removeClass("modal");
           event.preventDefault();
         });

         $("#browser-dialog input[type='button'].next").bind("click", function(event) {
           $(this).closest(".dialog").removeClass("show");
           $("#name-dialog").addClass("show");
         });
       });

       var DOC_URL = "/jdata";
       var rev = '';
       var items = {
           read: function(id, fn, err) {
             var url = DOC_URL + "/" + id;
             $.ajax({
               type: 'GET',
               url: url,
               dataType: 'json',
               beforeSend: function(xhr) {},
               success: function(data) {
                 console.log("read succeded: " + JSON.stringify(data));
                 rev = data._rev;
                 fn(data);
               },
               error: function(request, textStatus, errorThrown) {
                 // err
                 var exception = {datasetname: 'aspen', status: request.status, message: request.statusText, url: url, method: "read", kind: textStatus};
                 if (exception.status === 404 || exception.status == '404') {
                   items.update(id, {}, fn, function(nestedRequest, nestedTextStatus, nestedErrorThrown) {
                     var except = {datasetname: 'aspen', status: nestedRequest.status, message: nestedRequest.statusText, url: url, method: "read", kind: nestedTextStatus};
                     except.nested = exception;
                     err(except);
                   });
                 } else {
                   err(exception);
                 }
               }
             });
           },
           update: function(id, json, fn, err) {
             console.warn("updating...");
             var url = DOC_URL + "/" + id + "/" + encodeURIComponent(rev);
             $.ajax({
               type: 'PUT',
               url: url,
               data: json,
               dataType: 'json',
               beforeSend: function(xhr) {},
               success: function(data) {
                 json._rev = data._rev;
                 json._id = data._id;
                 fn(json);
               },
               error: function(request, textStatus, errorThrown) {
                 // err
                 var exception = {datasetname: 'aspen', status: request.status, message: request.statusText, url: url, method: "update", kind: textStatus};
                 err(exception);
               }
             });
           }
         };
    </script>
  </head>
  <body class="modal">
    <div id="container">
      <div id="joinbuttons" class="logo">
        <img src="./images/logo.png">
        Welcome, <span class="username">[[Blank]]</span>
      </div>
    </div>
    <div id="dialogs">
      <form id="connect-dialog" class="dialog" action="" method="POST">
        <h2>Getting <span>Ready</span>!</h2>
        <div class="spinnerfloat">
          <div class="spinner animate">
            <div class="bar1"></div><div class="bar2"></div><div class="bar3"></div><div class="bar4"></div>
            <div class="bar5"></div><div class="bar6"></div><div class="bar7"></div><div class="bar8"></div>
            <div class="bar9"></div><div class="bar10"></div><div class="bar11"></div><div class="bar12"></div>
          </div>
        </div>
        <span class="status">Connecting...</span>
      </form>
      <form id="name-dialog" class="dialog" action="" method="POST">
        <h2>Please enter your <span>name</span></h2>
        <br>
        <label for="">Name: </label><input type="text" class="next" name="username" value="tyip"/>
        <br>
        <input type="submit" class="next" value="Done"/>
      </form>
      <form id="browser-dialog" class="dialog show" action="" method="POST">
        <h2>Project is optimized for <span>Chrome</span></h2>
        Use Chrome for the best result
        <br>
        <input type="button" class="next" value="Okay"/>
      </form>
    </div>
  </body>
</html>
